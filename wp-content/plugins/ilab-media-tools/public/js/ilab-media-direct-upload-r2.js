!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=631)}({56:function(e,t,r){var o=r(97)();e.exports=o;try{regeneratorRuntime=o}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}},631:function(e,t,r){e.exports=r(632)},632:function(e,t,r){"use strict";r.r(t);var o=r(56),n=r.n(o);function i(e,t,r,o,n,i,a){try{var l=e[i](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(o,n)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(o,n){var a=e.apply(t,r);function l(e){i(a,o,n,l,u,"next",e)}function u(e){i(a,o,n,l,u,"throw",e)}l(void 0)}))}}window.ILABUploadToS3Storage=function(e,t,r,o){var i={action:"ilab_upload_prepare",filename:e.name,type:r};o.hasOwnProperty("uploadDirectory")&&(i.directory=o.uploadDirectory),console.log("Getting upload URL ..."),console.time("Getting upload URL"),jQuery.post(ajaxurl,i,(function(r){if("ready"==r.status){console.timeEnd("Getting upload URL"),o.set({state:"uploading"});var l=-1,u=Object.keys(r.sizes),c=[],s=r.key.split("/"),h=s.pop(),f=s.join("/")+"/",p=h.split("."),d=p.length>2?p.slice(0,p.length-1).join("."):p[0],g=p.length>1?"."+p[p.length-1]:"";g=g.toLowerCase();var m=function(t,r){i.filename=r.name,i.forcePath=f,jQuery.post(ajaxurl,i,(function(n){var i=new FileReader;i.onload=function(){!function(t,r){console.log("Upload "+t),jQuery.ajax({url:n.url,method:"PUT",data:r,contentType:!1,processData:!1,headers:{"Content-Length":r.length},xhr:function(){var t=jQuery.ajaxSettings.xhr();return t.upload.onprogress=function(t){if(-1===e.type.indexOf("image/")||1===u.length){var r=t.loaded/t.total*100;o.set({progress:r})}else{var n=100/u.length,i=n*l+t.loaded/t.total*n;o.set({progress:i})}}.bind(this),t},success:function(){console.timeEnd("Upload "+t),w()},error:function(e){console.timeEnd("Upload "+t),window.hasOwnProperty("mediaCloudDirectUploadError")&&!1!==window.mediaCloudDirectUploadError||(window.mediaCloudDirectUploadError=!0,alert("There was an error uploading this item.  The most likely cause is that you don't have CORS configured correctly on your bucket.")),o.uploadError()}})}(t,i.result)},i.readAsArrayBuffer(r)}))},y=null,v=null,w=function i(){if(console.log("Upload next size ..."),++l>=u.length||-1===e.type.indexOf("image/")||1===u.length)return console.log("finish upload"),void o.uploadFinished(r.key,t,c);var s=u[l];if("full"!==s)if(mediaCloudDirectUploadSettings.generateThumbnails){var h=function(t){var n=r.sizes[s],a=t.bitmap.width,l=t.bitmap.height;if(n.width>a&&n.height>l)i();else{if(console.log("Resizing JPEG file ..."),console.time("Resize JPEG image"),n.crop)t.cover(n.width,n.height,Jimp.HORIZONTAL_ALIGN_CENTER|Jimp.VERTICAL_ALIGN_MIDDLE,Jimp.RESIZE_BEZIER);else{var u=o.sizeToFitSize(a,l,n.width,n.height);t.resize(u[0],u[1],Jimp.RESIZE_BEZIER)}var h=d+"-"+t.bitmap.width+"x"+t.bitmap.height+g;"image/jpeg"!==e.type&&"image/jpg"!==e.type||t.quality(mediaCloudDirectUploadSettings.imageQuality),console.timeEnd("Resize JPEG image"),console.time("Get JPEG buffer"),t.getBuffer(e.type,(function(r,n){if(console.timeEnd("Get JPEG buffer"),null!=r)o.uploadError();else{var i={size:s,key:f+h,mime:e.type,width:t.bitmap.width,height:t.bitmap.height};c.push(i);var a=new File([n],h,{type:e.type});m(h,a)}}))}},p=function(e){var t=r.sizes[s],n=e.width,a=e.height;if(t.width>n&&t.height>a)i();else if(t.crop){var l=o.sizeToFillSize(n,a,t.width,t.height),u=d+"-"+t.width+"x"+t.height+g,h=document.createElement("canvas");h.width=l[0],h.height=l[1];var f=h.getContext("2d",{alpha:!0});f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(e,0,0,l[0],l[1]);var p=document.createElement("canvas"),y=p.getContext("2d",{alpha:!0});p.width=t.width,p.height=t.height,y.drawImage(h,Math.floor(t.width/2-l[0]/2),Math.floor(t.height/2-l[1]/2)),p.toBlob((function(e){var r={size:s,key:u,mime:"image/png",width:t.width,height:t.height};c.push(r),m(u,e)}),"image/png")}else{var v=o.sizeToFitSize(n,a,t.width,t.height),w=d+"-"+v[0]+"x"+v[1]+g,x=document.createElement("canvas");x.width=v[0],x.height=v[1];var b=x.getContext("2d",{alpha:!0});b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(e,0,0,v[0],v[1]),x.toBlob((function(e){var r={size:s,key:w,mime:"image/png",width:t.width,height:t.height};c.push(r),m(w,e)}),"image/png")}};if("image/png"===e.type)if(null==v){var w=new FileReader;w.onload=function(){(v=new Image).onload=function(){p(v)},v.src=w.result},w.readAsDataURL(e)}else p(v);else if(null==y){console.log("Reading JPEG file ...");var x=new FileReader;console.time("Read JPEG file"),x.onload=a(n.a.mark((function e(){var t,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Jimp.decoders["image/jpeg"],Jimp.decoders["image/jpeg"]=function(e){return t(e,{maxMemoryUsageInMB:2048})},e.prev=2,e.next=5,Jimp.read(x.result);case 5:y=e.sent,console.timeEnd("Read JPEG file"),(y.bitmap.width>2560||y.bitmap.height>2560)&&(console.log("Resizing huge image ..."),console.time("Resizing huge image"),r=o.sizeToFitSize(y.bitmap.width,y.bitmap.height,2560,2560),y.resize(r[0],r[1],Jimp.RESIZE_BEZIER),console.timeEnd("Resizing huge image")),h(y.clone()),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),alert("Insufficient memory to process image.  Please resize before uploading again."),o.uploadError();case 15:case"end":return e.stop()}}),e,null,[[2,11]])}))),x.readAsArrayBuffer(e)}else h(y.clone())}else i();else m(r.key,e)};-1===e.type.indexOf("image/")||1===u.length?m(r.key,e):w()}else o.uploadError()}))},"undefined"!=typeof DirectUploadItem&&(DirectUploadItem.prototype.uploadToStorage=ILABUploadToS3Storage),ilabMediaUploadItem.prototype.uploadToStorage=ILABUploadToS3Storage},97:function(e,t,r){var o=r(98).default;function n(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=n=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function h(e,t,r,o){var n=t&&t.prototype instanceof d?t:d,i=Object.create(n.prototype),a=new j(o||[]);return i._invoke=function(e,t,r){var o="suspendedStart";return function(n,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===n)throw i;return O()}for(r.method=n,r.arg=i;;){var a=r.delegate;if(a){var l=L(a,r);if(l){if(l===p)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===o)throw o="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o="executing";var u=f(e,t,r);if("normal"===u.type){if(o=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function d(){}function g(){}function m(){}var y={};s(y,l,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(R([])));w&&w!==r&&i.call(w,l)&&(y=w);var x=m.prototype=d.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var r;this._invoke=function(n,a){function l(){return new t((function(r,l){!function r(n,a,l,u){var c=f(e[n],e,a);if("throw"!==c.type){var s=c.arg,h=s.value;return h&&"object"==o(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,l,u)}),(function(e){r("throw",e,l,u)})):t.resolve(h).then((function(e){s.value=e,l(s)}),(function(e){return r("throw",e,l,u)}))}u(c.arg)}(n,a,r,l)}))}return r=r?r.then(l,l):l()}}function L(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,L(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=f(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var n=o.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=m,s(x,"constructor",m),s(m,"constructor",g),g.displayName=s(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,c,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},b(E.prototype),s(E.prototype,u,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,o,n,i){void 0===i&&(i=Promise);var a=new E(h(e,r,o,n),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(x),s(x,c,"Generator"),s(x,l,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var o=t.pop();if(o in e)return r.value=o,r.done=!1,r}return r.done=!0,r}},t.values=R,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return a.type="throw",a.arg=e,t.next=r,o&&(t.method="next",t.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o],a=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var l=i.call(n,"catchLoc"),u=i.call(n,"finallyLoc");if(l&&u){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var n=o;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var n=o.arg;_(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},98:function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}});