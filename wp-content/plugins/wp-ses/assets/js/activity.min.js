!function(n,t){function i(t){if(void 0===t)return!1;n(".wposes-notice").remove(),n("#tab-activity").prepend(t),n(".notice-dismiss").on("click",function(t){n(".wposes-notice").remove()})}var o={modalContainer:".wposes-view-email-prompt",modalOpen:!1,modalShown:!1,showPrompt:function(){t.setDismissibleState(!0),t.open(this.modalContainer,!1,"wposes-view-email-modal")},hidePrompt:function(){t.setDismissibleState(!0),t.close()},getEmail:function(t){n.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_activity_nonce:n("#wposes_activity_nonce").val(),action:"wposes_get_email",email_id:t},error:function(t,e,a){alert("error"+a)},success:function(t,e,a){o.showPrompt(),n(".wposes-view-email-prompt").html(t.data)}})}},s={init:function(){var a;n("#tab-activity .tablenav-pages a, #tab-activity .manage-column.sortable a, #tab-activity .manage-column.sorted a").on("click",function(t){t.preventDefault();var e=this.search.substring(1),a={paged:s.__query(e,"paged")||"1",order:s.__query(e,"order")||"desc",orderby:s.__query(e,"orderby")||"emails_sent"};s.update(a)}),n("input[name=paged]").on("keyup",function(t){13===t.which&&t.preventDefault();var e={paged:parseInt(n("#tab-activity input[name=paged]").val())||"1",order:n("#tab-activity input[name=order]").val()||"asc",orderby:n("#tab-activity input[name=orderby]").val()||"title"};window.clearTimeout(a),a=window.setTimeout(function(){s.update(e)},500)})},update:function(t){n.ajax({url:ajaxurl,data:n.extend({wposes_activity_nonce:n("#wposes_activity_nonce").val(),action:"wposes_activity_table",paged:parseInt(n("#tab-activity input[name=paged]").val())||"1"},t,s.get_search_data()),success:function(t){var e=n.parseJSON(t);e.rows.length&&n("#tab-activity #the-list").html(e.rows),e.column_headers.length&&n("#tab-activity .wp-list-table thead tr, #tab-activity .wp-list-table tfoot tr").html(e.column_headers),e.pagination.bottom.length&&n("#tab-activity .tablenav.top .tablenav-pages").html(n(e.pagination.top).html()),e.pagination.top.length&&n("#tab-activity .tablenav.bottom .tablenav-pages").html(n(e.pagination.bottom).html()),e.views.length&&n("#wposes-views-wrap").html(e.views),e.bulk_actions_result.length&&i(e.bulk_actions_result),s.init()}})},__query:function(t,e){for(var a=t.split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]===e)return n[1]}return!1},get_search_data:function(){var t={date:n("#wposes-filter-by-date").val(),subject:n("#wposes-subject-search").val(),recipient:n("#wposes-recipient-search").val(),status:n(".subsubsub a.current").data("status"),bulk_action:n("#bulk-action-selector-top").val(),bulk_selected:[]};return n('input[name="email[]"]:checked').each(function(){t.bulk_selected.push(n(this).val())}),t}};n(document).ready(function(){function e(t,e){if(!wposes.is_pro)return!1;n.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{wposes_activity_nonce:n("#wposes_activity_nonce").val(),action:"process_row_action",email_id:e,row_action:t},error:function(t,e,a){alert("error"+a)},success:function(t,e,a){i(t.data),s.update()}})}s.init(),wposes.is_pro||n("body").on("click",".row-actions span a",function(t){t.preventDefault();var e=n(this),a=e.position(),i=n(".wposes-upgrade-helper");i.css({left:a.left-i.width()/2-5+"px",top:a.top+e.height()+9+"px"}),i.toggle(),t.stopPropagation()}),n("#wposes-activity-form").on("submit",function(t){t.preventDefault(),s.update({paged:1})}),n("#wposes-views-wrap").on("click","a",function(t){t.preventDefault(),n("#wposes-views-wrap a").removeClass("current"),n(this).addClass("current"),s.update({paged:1})}),n("#tab-activity").on("click",".wposes-view-email",{},function(t){if(t.preventDefault(),wposes.is_pro){var e=n(this).data("email");o.getEmail(e)}}),n("body").on("click",".wposes-resend-email",{},function(t){t.preventDefault(),o.hidePrompt(),e("resend",n(this).data("email"))}),n("body").on("click",".wposes-cancel-email",{},function(t){t.preventDefault(),o.hidePrompt(),e("cancel",n(this).data("email"))}),n("body").on("click",".wposes-delete-email",{},function(t){t.preventDefault(),o.hidePrompt(),e("delete",n(this).data("email"))})})}(jQuery,wposesModal);